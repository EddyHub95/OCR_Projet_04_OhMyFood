"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8ab39abc-382c-54d1-b3b2-0199cc99bc35")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7220],{994059:(e,a,t)=>{t.d(a,{KE:()=>_,KW:()=>x,Ku:()=>g,Mp:()=>d,SC:()=>n,Sm:()=>r,UB:()=>T,Ut:()=>E,WW:()=>w,_e:()=>p,e:()=>s,eY:()=>f,gh:()=>c,i6:()=>v,iK:()=>o,kl:()=>l,ms:()=>i,ob:()=>h,q4:()=>u,sH:()=>N,w7:()=>y,y:()=>m});let l="autosave_modal--modal--Egqg3",s="autosave_modal--title--Q-T-o",n="autosave_modal--body--pv4yP",o="autosave_modal--fileRows--JQWy9",i="autosave_modal--fileRow--vBNLB",c="autosave_modal--userRows--fG3Qq",r="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",m="autosave_modal--onlyFileRowText--NGT-7",u="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",d="autosave_modal--fileMetadata--JIecy",v="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",E="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",f="autosave_modal--logOutButtons--961-N",_="autosave_modal--logOutDiscard--MvTW-",g="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",N="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",y="autosave_modal--expiryAndDone--ck-oP",h="autosave_modal--done--F-hm3",p="autosave_modal--expiryWrapper--1Ee1U",T="autosave_modal--expiry--E2Ybr",w="autosave_modal--warningIcon--T1wLu",x="autosave_modal--openToSync--KQUfj"},51056:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>u});var l=t(307824),s=t(120304),n=t(105516),o=t(148276),i=t(560072),c=t(323576),r=t(158196),m=t(994059);function u({userInOrg:e}){let a=(0,s.OY)();return l.createElement(r.wJ,{className:m.kl,dispatch:a},l.createElement(n.cT,{dispatch:a}),l.createElement("div",{className:m.e},l.createElement(i.Tx,{id:"autosave.learn_more.title"})),l.createElement("div",{className:m.SC},l.createElement(i.Tx,{id:"autosave.learn_more.body_save_pending_changes"})),l.createElement("div",{className:m.SC},l.createElement(i.Tx,{id:"autosave.learn_more.body_use_version_history"})),l.createElement("div",{className:m.Ku},l.createElement(o.wX,{onClick:()=>{a(c.oN())},className:m.ob},l.createElement(i.Tx,{id:"autosave.learn_more.done_button"}))))}},591436:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>q,HasAutosaveChangesModal:()=>R});var l=t(307824),s=t(120304),n=t(854384),o=t.n(n),i=t(139776),c=t(972920),r=t(899116),m=t(656716),u=t(4580),d=t(326660),v=t(58908),E=t(105516),f=t(148276),_=t(383456),g=t(537096),N=t(699248),y=t(560072),h=t(257200),p=t(323576),T=t(1084),w=t(243536),x=t(170004),C=t(887816),k=t(846004),b=t(251596),O=t(333928),S=t(553432),A=t(897712),F=t(685656),M=t(650180),K=t(794132),L=t(158196),U=t(994059),W=t(324847);function B(e){return e.user?l.createElement("div",{className:U.q4},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function D(e,a){let t=!1,l=null;try{let{data:s}=await M.i.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=s.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,d.Ij)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let Y=(e,a)=>(0,c.C)(()=>{let t=new URL((0,O.So)(e,!0));t.searchParams.append("fuid",a),m.default.redirect(t.toString(),"_blank")}),j=(e,a)=>(0,c.C)(()=>e(h.y_({file:a,openNewFileIn:F.mM.NEW_TAB,source:A.I.AUTOSAVE_MODAL})));function I(e,a,t){return(0,x.qG)(a)?{fileName:a.file.name,onClick:Y(a.file,t.id),thumbnail:l.createElement(K.e,{file:a.file,listView:"slightly-larger"})}:{fileName:a.name,onClick:j(e,a),thumbnail:l.createElement(N.m,{listView:"slightly-larger"})}}function P(e){let{fileName:a,onClick:t,thumbnail:n}=I((0,s.OY)(),e.fileState,e.user);return l.createElement("div",{className:U.ms,key:e.fileState.fileKey},n,l.createElement("div",{className:U.Mp},l.createElement("div",{className:U.i6},a),l.createElement("div",{className:U.Ut},l.createElement(y.Tx,{id:"tile.file_tile.edited_time",time:l.createElement(_.O,{date:e.fileState.lastUpdatedAt})}))),l.createElement(f.wX,{className:U.KW,onClick:t},l.createElement(y.Tx,{id:"autosave.has_changes.open_to_sync"})))}function X(e){return l.createElement("div",{className:U.gh},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:U.iK},l.createElement(B,{user:e.users.filter(e=>(null==e?void 0:e.id)===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement(P,{fileState:t,user:e.users.filter(e=>(null==e?void 0:e.id)===a)[0],key:t.fileKey}))))))}function G(e,a,t,s,n,i){let c;let r=i||(()=>{e(p.oN())}),m=H(t),u=1===o()(Object.values(a)).length,d=null,v=null,_=null,N=null,h=null;if(u){d=o()(Object.values(a))[0];let t=Object.keys(a).filter(e=>a[e].length>0)[0],n=I(e,d,v=s.filter(e=>(null==e?void 0:e.id)===t)[0]);_=n.fileName,N=n.onClick,h=n.thumbnail,c=l.createElement("div",null,l.createElement(B,{user:v}),l.createElement("div",{className:U.Sm},h,l.createElement("div",{className:U.y},l.createElement(y.Tx,{id:"autosave.has_changes.unsaved_changes_to_file",fileName:l.createElement("span",{className:U.e},_)}))))}else c=l.createElement("div",null,l.createElement("div",{className:U.SC},l.createElement(y.Tx,{id:"autosave.has_changes.unsynced_changes_offline"})),l.createElement(X,{files:a,users:s}));return l.createElement(L.wJ,{className:U.kl,dispatch:e,size:500,tintedModalBackground:!0},l.createElement(E.cT,{dispatch:e}),l.createElement("div",{className:U.e},l.createElement(y.Tx,{id:"autosave.has_changes.sync_offline_changes"})),c,m||n||u?l.createElement("div",{className:U.w7},m&&l.createElement("div",{className:U._e},l.createElement(g.A,{svg:W.c,className:U.WW}),l.createElement("div",{className:U.UB},m)),l.createElement("div",{className:U.sH},n?l.createElement(f.wX,{onClick:r},l.createElement(y.Tx,{id:"autosave.has_changes.dismiss.later"})):null,u&&N&&l.createElement(f.gV,{onClick:N},l.createElement(y.Tx,{id:"autosave.has_changes.open_to_sync"})))):null)}function R(){let e=(0,s.OY)(),a=function(){let e=(0,k.wp)(),{modalShown:a,autosave:t}=(0,u.q)(e=>({modalShown:e.modalShown,autosave:e.autosave})),s=(0,S.usePermissionsState)();return l.useMemo(()=>a?[...(0,T._W)((0,T.DL)((0,T.Su)(t.unclaimedFilesWithChangesInIDB,s),e),e),...t.unclaimedFilesCreatedOffline]:[],[a,t.unclaimedFilesWithChangesInIDB,t.unclaimedFilesCreatedOffline,e,s])}(),t=(0,s.w1)(e=>e.autosave.nextGarbageCollectionTimestamp),n=(0,b.C2)(),o=null==n?void 0:n.id;return o&&n?G(e,{[o]:a},t,[n],!0):null}function J(e){let a=(0,s.OY)(),[t,n]=l.useState(!1),[o,i]=l.useState(!1),c=async()=>{try{for(let a of e.users){let e=null==a?void 0:a.id;e&&await (0,T.W8)((0,w.us)(e))}}finally{i(!0)}},m=()=>{n(!0)};if(o)return l.createElement(L.wJ,{className:U.kl,dispatch:a,size:384,tintedModalBackground:!0},l.createElement(E.cT,{dispatch:a}),l.createElement("div",{className:U.e},l.createElement(y.Tx,{id:"autosave.logout.offline_changes"})),l.createElement("div",{className:U.SC},l.createElement(y.Tx,{id:"autosave.logout.offline_changes_discarded"})),l.createElement("div",{className:U.ob},l.createElement(f.wX,{onClick:e.onLogOut},l.createElement(y.Tx,{id:"autosave.logout.log_out"}))));if(0===Object.values(e.files).length&&e.loaded)return l.createElement(L.wJ,{className:U.kl,dispatch:a,size:384,tintedModalBackground:!0},l.createElement(E.cT,{dispatch:a}),l.createElement("div",{className:U.e},l.createElement(y.Tx,{id:"autosave.logout.offline_changes"})),l.createElement("div",{className:U.SC},l.createElement(y.Tx,{id:"autosave.logout.offline_changes_synced"})),l.createElement("div",{className:U.ob},l.createElement(f.wX,{onClick:e.onLogOut},l.createElement(y.Tx,{id:"autosave.logout.log_out"}))));if(t)return G(a,e.files,e.nextGarbageCollectionTimestamp,e.users,!1,()=>{n(!1)});{let t;let s=r.sZ?(0,y.t)("autosave.logout.log_out_text.desktop"):(0,y.t)("autosave.logout.log_out_text.web");return t=r.sZ?l.createElement("div",{className:U.eY},l.createElement("div",{className:U.KE},l.createElement(f.OC,{onClick:c},l.createElement(y.Tx,{id:"autosave.logout.discard_and_logout"}))),l.createElement("div",{className:U.Ku},l.createElement(f.wX,{onClick:()=>{a(p.Kw())}},l.createElement(y.Tx,{id:"autosave.logout.cancel"})),l.createElement(f.wX,{onClick:m},l.createElement(y.Tx,{id:"autosave.logout.show_changes"})))):l.createElement("div",{className:U.eY},l.createElement("div",{className:U.KE},l.createElement(f.OC,{onClick:c},l.createElement(y.Tx,{id:"autosave.logout.discard"}))),l.createElement("div",{className:U.Ku},l.createElement(f.wX,{onClick:e.onLogOut},l.createElement(y.Tx,{id:"autosave.logout.log_out"})),l.createElement(f.gV,{onClick:m},l.createElement(y.Tx,{id:"autosave.logout.sync_changes"})))),l.createElement(L.wJ,{className:U.kl,dispatch:a,size:424,tintedModalBackground:!0},l.createElement(E.cT,{dispatch:a}),l.createElement("div",{className:U.e},l.createElement(y.Tx,{id:"autosave.has_changes.sync_offline_changes"})),l.createElement("div",{className:U.SC},s),t)}}function q(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:n,autosaveFilesToDelete:o}=function(e){let a=(0,s.OY)(),[t,n]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,T.ct)((0,i.Ib)(e.map(e=>null==e?void 0:e.id))),t={},l=[],s=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)s.push(D(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(s))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));n({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,d.WI)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,d.oP)(v._.SCENEGRAPH_AND_SYNC,e)):(0,d.oP)(v._.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return C.Wu.register(C.aY,a),a(),function(){C.Wu.unregister(C.aY,a)}},[a,e]),t}(e.users);return(0,b.sX)()?l.createElement(J,{loaded:n,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of o)(0,T.W8)((0,w.iO)(e.userID,e.fileKey)).catch(e=>{(0,d.oP)(v._.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}R.displayName="HasAutosaveChangesModal";let H=e=>{let a=Math.floor(((0,T.GG)()-(Date.now()-e))/864e5);return a>5?null:a<1?l.createElement(y.Tx,{id:"autosave.has_changes.expiry_text_shortly"}):l.createElement(y.Tx,{id:"autosave.has_changes.expiry_text_days",days:a})};q.displayName="AutosaveLogOutModal"},917264:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>d});var l=t(307824),s=t(120304),n=t(250008),o=t(148276),i=t(698240),c=t(560072),r=t(323576),m=t(158196),u=t(994059);function d(e){let a=(0,s.OY)();return(0,l.useEffect)(()=>(0,n.we)("New Autosave File Already Open Modal Shown")),l.createElement(m.wJ,{dispatch:a,size:360,tintedModalBackground:!0},l.createElement("div",{className:u.e},l.createElement(c.Tx,{id:"autosave.file_already_open_modal.title"})),l.createElement("div",{className:u.SC},l.createElement(c.Tx,{id:"autosave.file_already_open_modal.body",fileName:l.createElement("span",{className:i.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:u.ob},l.createElement(o.wX,{onClick:()=>a(r.oN())},l.createElement(c.Tx,{id:"general.ok"}))))}d.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=8ab39abc-382c-54d1-b3b2-0199cc99bc35

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/dc6d0e9185426a19a2e7d5de77427aec190ed65b/autosave-56119072379795db.min.js.map